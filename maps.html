<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Albury Development Map Check (Demo)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Leaflet + Turf -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:20px}
    a.back{display:inline-block;margin-bottom:12px;text-decoration:none;color:#0077cc}
    h1{font-size:22px;margin:6px 0 10px;text-align:center}
    #map{height:440px;border-radius:12px;border:1px solid #eee}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;margin:10px 0 14px}
    .chip{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;margin:3px 6px 0 0;border:1px solid}
    .ok{background:#eaf7ea;color:#1b5e20;border-color:#b6e3b6}
    .bad{background:#fdecea;color:#8a130c;border-color:#f5c6c3}
    .note{color:#666;font-size:12px;text-align:center;margin-top:8px}
  </style>

</head>
<body>


<a href="property.html?id=001" class="back">← Back</a>
<h1>Map of Albury </h1>

<div class="toolbar">
  <label><input type="checkbox" id="toggle-heritage" checked> Heritage</label>
  <label><input type="checkbox" id="toggle-bushfire" checked> Bushfire-prone</label>
  <label><input type="checkbox" id="toggle-flood" checked> Flood</label>
  <label><input type="checkbox" id="toggle-slope" checked> Steep slope</label>
  <span id="chips"></span>
</div>



<div id="map"></div>
<div class="note">Demo map only for stakeholder preview.</div>

<!-- Demo GeoJSON polygons (replace with real datasets later) -->
<script>
const HERITAGE_AREAS = {"type":"FeatureCollection","features":[
  {"type":"Feature","properties":{"name":"Heritage Precinct A"},"geometry":{"type":"Polygon","coordinates":[
    [[146.9080,-36.0860],[146.9185,-36.0860],[146.9185,-36.0790],[146.9080,-36.0790],[146.9080,-36.0860]]
  ]}}
]};
const BUSHFIRE_ZONES = {"type":"FeatureCollection","features":[
  {"type":"Feature","properties":{"cat":"BFZ"},"geometry":{"type":"Polygon","coordinates":[
    [[146.9250,-36.0950],[146.9450,-36.0950],[146.9450,-36.0800],[146.9250,-36.0800],[146.9250,-36.0950]]
  ]}}
]};
const FLOOD_ZONES = {"type":"FeatureCollection","features":[
  {"type":"Feature","properties":{"cat":"Floodway"},"geometry":{"type":"Polygon","coordinates":[
    [[146.9100,-36.0950],[146.9300,-36.0950],[146.9300,-36.0850],[146.9100,-36.0850],[146.9100,-36.0950]]
  ]}}
]};
const STEEP_SLOPE = {"type":"FeatureCollection","features":[
  {"type":"Feature","properties":{"slope":">15°"},"geometry":{"type":"Polygon","coordinates":[
    [[146.9000,-36.0800],[146.9100,-36.0800],[146.9100,-36.0725],[146.9000,-36.0725],[146.9000,-36.0800]]
  ]}}
]};
</script>

<script>
const map = L.map('map').setView([-36.08,146.92],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

const heritageLayer = L.geoJSON(HERITAGE_AREAS,{style:{color:'#8e44ad',weight:2,fillOpacity:0.1}}).addTo(map);
const bushfireLayer = L.geoJSON(BUSHFIRE_ZONES,{style:{color:'#d35400',weight:2,fillOpacity:0.1}}).addTo(map);
const floodLayer    = L.geoJSON(FLOOD_ZONES,{style:{color:'#2980b9',weight:2,fillOpacity:0.1}}).addTo(map);
const slopeLayer    = L.geoJSON(STEEP_SLOPE,{style:{color:'#27ae60',weight:2,fillOpacity:0.1}}).addTo(map);

document.getElementById('toggle-heritage').onchange = e => e.target.checked ? heritageLayer.addTo(map) : map.removeLayer(heritageLayer);
document.getElementById('toggle-bushfire').onchange = e => e.target.checked ? bushfireLayer.addTo(map) : map.removeLayer(bushfireLayer);
document.getElementById('toggle-flood').onchange    = e => e.target.checked ? floodLayer.addTo(map)    : map.removeLayer(floodLayer);
document.getElementById('toggle-slope').onchange    = e => e.target.checked ? slopeLayer.addTo(map)    : map.removeLayer(slopeLayer);

let marker=null;
function contains(fc, pt){ return fc.features?.some(f=>turf.booleanPointInPolygon(pt,f)) || false; }
function chips(ctx){
  const mk=(name,inside)=>`<span class="chip ${inside?'bad':'ok'}">${name}: ${inside?'Inside':'Outside'}</span>`;
  document.getElementById('chips').innerHTML = mk('Heritage',ctx.h)+mk('Bushfire',ctx.b)+mk('Flood',ctx.f)+mk('Slope',ctx.s);
}
function evaluate(latlng){
  const pt=turf.point([latlng.lng,latlng.lat]);
  const ctx={h:contains(HERITAGE_AREAS,pt),b:contains(BUSHFIRE_ZONES,pt),f:contains(FLOOD_ZONES,pt),s:contains(STEEP_SLOPE,pt)};
  heritageLayer.setStyle({color:'#8e44ad',weight:2,fillOpacity: ctx.h?0.25:0.1});
  bushfireLayer.setStyle({color:'#d35400',weight:2,fillOpacity: ctx.b?0.25:0.1});
  floodLayer.setStyle({color:'#2980b9',weight:2,fillOpacity: ctx.f?0.25:0.1});
  slopeLayer.setStyle({color:'#27ae60',weight:2,fillOpacity: ctx.s?0.25:0.1});
  chips(ctx);
}
map.on('click', e=>{
  if(marker) map.removeLayer(marker);
  marker=L.marker(e.latlng,{draggable:true}).addTo(map);
  evaluate(e.latlng);
  marker.on('dragend',ev=>evaluate(ev.target.getLatLng()));
});

evaluate(map.getCenter());
</script>
</body>
</html>
